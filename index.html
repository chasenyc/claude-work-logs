<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Terminal Log Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'SF Mono', 'Monaco', 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            overflow: hidden;
            height: 100vh;
        }

        .terminal-window {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #1a1a1a;
        }

        .terminal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            background-color: #2a2a2a;
            border-bottom: 1px solid #333333;
            font-size: 12px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .control-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .control-dot.red { background-color: #ff5f57; }
        .control-dot.yellow { background-color: #ffbd2e; }
        .control-dot.green { background-color: #28ca42; }

        .tab-info {
            color: #888888;
            font-size: 11px;
            margin-left: 8px;
        }

        .project-context {
            color: #888888;
            font-size: 11px;
        }

        .project-context::before {
            content: "‚ùÑ ";
            margin-right: 4px;
        }

        .terminal-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .controls-bar {
            padding: 12px 20px;
            background-color: #2a2a2a;
            border-bottom: 1px solid #333333;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            background: #1a1a1a;
            border: 1px solid #444444;
            color: #ffffff;
            padding: 6px 12px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 12px;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .search-input::placeholder {
            color: #666666;
        }

        .filter-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 4px 8px;
            background: #1a1a1a;
            border: 1px solid #444444;
            color: #cccccc;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background: #333333;
            border-color: #555555;
        }

        .filter-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: #ffffff;
        }

        .filter-badge {
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            font-size: 9px;
            font-weight: 600;
            display: none;
            align-items: center;
            justify-content: center;
            margin-left: 4px;
        }

        .filter-badge.show {
            display: inline-flex;
        }

        .stats-bar {
            padding: 8px 20px;
            background-color: #2a2a2a;
            border-bottom: 1px solid #333333;
            display: flex;
            gap: 20px;
            font-size: 11px;
            color: #888888;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-number {
            color: #ffffff;
            font-weight: 600;
        }

        .session-summary {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 11px;
            color: #888888;
        }

        .session-stat {
            color: #ffffff;
            font-weight: 500;
        }

        .log-area {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .log-entry {
            border-bottom: 1px solid #333333;
            transition: background-color 0.1s ease;
        }

        .log-entry:hover {
            background-color: #252525;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-header {
            padding: 8px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
        }

        .log-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 8px;
        }

        .log-type.system {
            background: #1e3a8a;
            color: #93c5fd;
        }

        .log-type.assistant {
            background: #581c87;
            color: #d8b4fe;
        }

        .log-type.tool {
            background: #166534;
            color: #86efac;
        }

        .log-type.failed-tool {
            background: #991b1b;
            color: #fca5a5;
        }

        .log-type.user {
            background: #92400e;
            color: #fbbf24;
        }

        .log-meta {
            color: #888888;
            font-size: 11px;
            flex: 1;
        }

        .log-toggle {
            color: #666666;
            font-size: 10px;
            transition: transform 0.2s ease;
        }

        .log-entry.expanded .log-toggle {
            transform: rotate(180deg);
        }

        .log-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background-color: #222222;
        }

        .log-entry.expanded .log-content {
            max-height: 2000px;
        }

        .log-content-inner {
            padding: 12px 20px;
            border-top: 1px solid #333333;
        }

        .terminal-text {
            color: #ffffff;
            white-space: pre-wrap;
            margin: 4px 0;
            font-size: 11px;
            line-height: 1.4;
        }

        .terminal-tool-call {
            margin: 8px 0;
            background: #2a2a2a;
            border-left: 3px solid #667eea;
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
        }

        .tool-header {
            color: #888888;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tool-params {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 3px;
            padding: 6px 8px;
            font-size: 11px;
            overflow-x: auto;
            color: #cccccc;
        }

        .terminal-thinking details {
            margin: 8px 0;
        }

        .terminal-thinking summary {
            color: #888888;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 0;
        }

        .thinking-content {
            color: #cccccc;
            font-size: 12px;
            line-height: 1.4;
            margin-top: 6px;
            padding-left: 12px;
            border-left: 2px solid #333333;
        }

        .terminal-tool-result {
            margin: 6px 0;
        }

        .tool-output {
            font-size: 12px;
            line-height: 1.3;
            border-radius: 3px;
            padding: 8px;
            border: 1px solid #333333;
        }

        .tool-output.success {
            background: #1a2e1a;
            border-color: #166534;
            color: #86efac;
        }

        .tool-output.error {
            background: #2e1a1a;
            border-color: #991b1b;
            color: #fca5a5;
        }

        .tool-output pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .original-tool-call {
            margin: 6px 0 12px 0;
            background: #2a2a1a;
            border: 1px solid #92400e;
            border-radius: 4px;
            padding: 8px;
        }

        .original-tool-header {
            color: #fbbf24;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .original-tool-params {
            background: #1a1a0a;
            border: 1px solid #92400e;
            border-radius: 3px;
            padding: 6px 8px;
            font-size: 10px;
            overflow-x: auto;
            color: #fbbf24;
        }

        .expand-btn {
            color: #888888;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 2px;
            background: #2a2a2a;
            border: 1px solid #333333;
            font-size: 10px;
            margin-top: 4px;
        }

        .expand-btn:hover {
            background: #333333;
            border-color: #444444;
        }

        .user-message {
            background: #2a2a2a;
            border-left: 3px solid #fbbf24;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 0 3px 3px 0;
        }

        .system-result {
            background: #1a2e1a;
            border: 1px solid #166534;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
        }

        .system-result.error {
            background: #2e1a1a;
            border: 1px solid #991b1b;
            color: #fca5a5;
        }

        .result-header {
            color: #86efac;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            border-bottom: 1px solid #166534;
            padding-bottom: 6px;
        }

        .result-content {
            color: #ffffff;
            font-size: 11px;
            line-height: 1.4;
            margin-bottom: 12px;
            white-space: pre-wrap;
        }

        .result-metadata {
            border-top: 1px solid #166534;
            padding-top: 8px;
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .metadata-item {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
        }

        .metadata-label {
            color: #888888;
            font-weight: 500;
        }

        .metadata-value {
            color: #ffffff;
            font-weight: 600;
        }

        .json-viewer {
            background: #1a1a1a;
            color: #ffffff;
            padding: 12px;
            border-radius: 4px;
            font-size: 11px;
            line-height: 1.4;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333333;
        }

        .json-key { color: #63b3ed; }
        .json-string { color: #68d391; }
        .json-number { color: #fbb6ce; }
        .json-boolean { color: #f6ad55; }
        .json-null { color: #a0aec0; }

        .data-input-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .data-input-modal {
            background: #2a2a2a;
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 24px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .data-input-modal h3 {
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .data-input-modal p {
            color: #cccccc;
            margin-bottom: 16px;
            font-size: 11px;
        }

        .json-input {
            width: 100%;
            height: 200px;
            background: #1a1a1a;
            border: 1px solid #444444;
            color: #ffffff;
            padding: 12px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 12px;
            line-height: 1.4;
            resize: vertical;
        }

        .json-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .json-input::placeholder {
            color: #666666;
        }

        .input-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-top: 16px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #444444;
            background: #333333;
            color: #ffffff;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #444444;
            border-color: #555555;
        }

        .btn.primary {
            background: #667eea;
            border-color: #667eea;
        }

        .btn.primary:hover {
            background: #5a67d8;
            border-color: #5a67d8;
        }

        .load-status {
            font-size: 12px;
            font-weight: 500;
        }

        .load-status.success { color: #86efac; }
        .load-status.error { color: #fca5a5; }

        .hidden { display: none; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888888;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #333333;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #888888;
        }

        .no-results-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        /* Scrollbar styling */
        .log-area::-webkit-scrollbar {
            width: 8px;
        }

        .log-area::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .log-area::-webkit-scrollbar-thumb {
            background: #444444;
            border-radius: 4px;
        }

        .log-area::-webkit-scrollbar-thumb:hover {
            background: #555555;
        }

        /* Diff view styles */
        .edit-file-path {
            color: #86efac;
            font-size: 12px;
            font-weight: 600;
            margin: 6px 0 8px 0;
            padding: 4px 8px;
            background: #1a2e1a;
            border: 1px solid #166534;
            border-radius: 3px;
        }

        .diff-container {
            margin: 8px 0;
            border: 1px solid #333333;
            border-radius: 4px;
            overflow: hidden;
            background: #1a1a1a;
        }

        .diff-line {
            display: flex;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 11px;
            line-height: 1.4;
        }

        .diff-line-number {
            width: 40px;
            padding: 2px 8px;
            text-align: right;
            background: #2a2a2a;
            color: #666666;
            border-right: 1px solid #333333;
            user-select: none;
            flex-shrink: 0;
        }

        .diff-line-content {
            padding: 2px 8px;
            flex: 1;
            white-space: pre;
            overflow-x: auto;
        }

        .diff-line.removed {
            background: #2e1a1a;
            border-left: 3px solid #991b1b;
        }

        .diff-line.removed .diff-line-number {
            background: #3a1a1a;
            color: #fca5a5;
        }

        .diff-line.removed .diff-line-content {
            color: #fca5a5;
        }

        .diff-line.added {
            background: #1a2e1a;
            border-left: 3px solid #166534;
        }

        .diff-line.added .diff-line-number {
            background: #1a3a1a;
            color: #86efac;
        }

        .diff-line.added .diff-line-content {
            color: #86efac;
        }

        .diff-line.context {
            background: #1a1a1a;
        }

        .diff-line.context .diff-line-content {
            color: #cccccc;
        }

        .diff-header {
            background: #2a2a2a;
            color: #888888;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 600;
            border-bottom: 1px solid #333333;
        }

        @media (max-width: 768px) {
            .controls-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .search-input {
                min-width: auto;
            }

            .stats-bar {
                flex-wrap: wrap;
                gap: 12px;
            }

            .log-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .data-input-modal {
                width: 95%;
                padding: 16px;
            }

            .diff-line-number {
                width: 30px;
                padding: 2px 4px;
            }

            .diff-line-content {
                padding: 2px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="terminal-window">
        <div class="terminal-header">
            <div class="window-controls">
                <div class="control-dot red"></div>
                <div class="control-dot yellow"></div>
                <div class="control-dot green"></div>
                <span class="tab-info">‚åò‚åò4</span>
            </div>
            <div class="project-context">Claude Code Log Viewer</div>
        </div>

        <div class="terminal-content">
            <div class="controls-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="Search through messages, tools, or content...">
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="system">System</button>
                    <button class="filter-btn" data-filter="assistant">Assistant</button>
                    <button class="filter-btn" data-filter="tool">Tools</button>
                    <button class="filter-btn" data-filter="failed-tool">
                        Failed
                        <span class="filter-badge" id="failedToolBadge">0</span>
                    </button>
                    <button class="filter-btn" data-filter="user">User</button>
                    <button class="btn" id="loadDataBtn">üìã Load Data</button>
                </div>
            </div>

            <div class="stats-bar" id="statsContainer">
                <div class="stat-item">
                    <span class="stat-number" id="totalEntries">-</span>
                    <span>entries</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="assistantMessages">-</span>
                    <span>assistant</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="toolCalls">-</span>
                    <span>tools</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="systemMessages">-</span>
                    <span>system</span>
                </div>
                <div class="session-summary" id="sessionSummary" style="display: none; margin-left: auto; gap: 12px;"></div>
            </div>

            <div class="log-area" id="logEntries">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Ready to load Claude Code execution log...</div>
                    <div style="margin-top: 8px; font-size: 11px; color: #666666;">Click "üìã Load Data" to paste your JSON log data</div>
                </div>
            </div>
        </div>
    </div>

    <div class="data-input-overlay hidden" id="dataInputOverlay">
        <div class="data-input-modal">
            <h3>Load Claude Code Log Data</h3>
            <p>Paste your JSON log data below</p>
            <textarea class="json-input" id="jsonInput" placeholder="Paste your JSON data here..." rows="8"></textarea>
            <div class="input-controls">
                <button class="btn primary" id="loadJsonBtn">Load Data</button>
                <button class="btn" id="clearJsonBtn">Clear</button>
                <button class="btn" id="cancelBtn">Cancel</button>
                <span class="load-status" id="loadStatus"></span>
            </div>
        </div>
    </div>

    <script>
        class ClaudeTerminalLogViewer {
            constructor() {
                this.logData = [];
                this.filteredData = [];
                this.currentFilter = 'all';
                this.searchTerm = '';
                this.stats = {
                    total: 0,
                    assistant: 0,
                    system: 0,
                    tool: 0,
                    failedTool: 0,
                    user: 0
                };
                
                this.init();
            }

            async init() {
                this.bindEvents();
            }

            bindEvents() {
                // Data input controls
                const loadDataBtn = document.getElementById('loadDataBtn');
                const loadJsonBtn = document.getElementById('loadJsonBtn');
                const clearJsonBtn = document.getElementById('clearJsonBtn');
                const cancelBtn = document.getElementById('cancelBtn');
                const jsonInput = document.getElementById('jsonInput');
                const overlay = document.getElementById('dataInputOverlay');

                loadDataBtn.addEventListener('click', () => {
                    overlay.classList.remove('hidden');
                    jsonInput.focus();
                });

                cancelBtn.addEventListener('click', () => {
                    overlay.classList.add('hidden');
                });

                loadJsonBtn.addEventListener('click', () => {
                    this.loadDataFromInput();
                });

                clearJsonBtn.addEventListener('click', () => {
                    jsonInput.value = '';
                    this.setLoadStatus('');
                });

                // Auto-load on paste
                jsonInput.addEventListener('paste', () => {
                    setTimeout(() => {
                        if (jsonInput.value.trim()) {
                            this.loadDataFromInput();
                        }
                    }, 100);
                });

                // Search functionality
                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase();
                    this.applyFilters();
                });

                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    if (btn.dataset.filter) {
                        btn.addEventListener('click', (e) => {
                            document.querySelectorAll('.filter-btn').forEach(b => {
                                if (b.dataset.filter) b.classList.remove('active');
                            });
                            e.target.classList.add('active');
                            this.currentFilter = e.target.dataset.filter;
                            this.applyFilters();
                        });
                    }
                });

                // Close overlay on escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        overlay.classList.add('hidden');
                    }
                });
            }

            applyFilters() {
                this.filteredData = this.logData.filter(entry => {
                    // Type filter
                    const matchesFilter = this.currentFilter === 'all' || 
                                        this.getEntryType(entry) === this.currentFilter;

                    // Search filter
                    const matchesSearch = this.searchTerm === '' || 
                                        this.entryMatchesSearch(entry, this.searchTerm);

                    return matchesFilter && matchesSearch;
                });

                this.renderEntries();
            }

            entryMatchesSearch(entry, searchTerm) {
                const searchableText = JSON.stringify(entry).toLowerCase();
                return searchableText.includes(searchTerm);
            }

            findOriginalToolCall(toolUseId) {
                // Search backwards through log data to find the assistant entry with matching tool call
                for (let i = this.logData.length - 1; i >= 0; i--) {
                    const entry = this.logData[i];
                    if (entry.type === 'assistant' && entry.message?.content) {
                        const toolCall = entry.message.content.find(item => 
                            item.type === 'tool_use' && item.id === toolUseId
                        );
                        if (toolCall) {
                            return toolCall;
                        }
                    }
                }
                return null;
            }

            getEntryType(entry) {
                if (entry.type === 'system') return 'system';
                if (entry.type === 'assistant') return 'assistant';
                if (entry.type === 'tool') return 'tool';
                
                // Check if this is actually a tool result disguised as user
                if (entry.type === 'user' && entry.message?.content) {
                    const hasToolResult = entry.message.content.some(item => item.type === 'tool_result');
                    if (hasToolResult) {
                        // Check if any tool result has an error
                        const hasFailedTool = entry.message.content.some(item => {
                            if (item.type === 'tool_result') {
                                const content = item.content;
                                let output = '';
                                
                                if (Array.isArray(content)) {
                                    output = content.map(c => c.text || JSON.stringify(c)).join('\n');
                                } else if (typeof content === 'string') {
                                    output = content;
                                } else {
                                    output = JSON.stringify(content, null, 2);
                                }
                                
                                return item.is_error === true || 
                                       (item.error !== undefined && item.error !== null) ||
                                       (typeof output === 'string' && output.toLowerCase().startsWith('error:'));
                            }
                            return false;
                        });
                        
                        return hasFailedTool ? 'failed-tool' : 'tool';
                    }
                }
                
                if (entry.type === 'user') return 'user';
                return 'system'; // default
            }

            updateStats() {
                this.stats.total = this.logData.length;
                this.stats.assistant = this.logData.filter(e => this.getEntryType(e) === 'assistant').length;
                this.stats.system = this.logData.filter(e => this.getEntryType(e) === 'system').length;
                // Count both 'tool' and 'failed-tool' as tools for the main counter
                this.stats.tool = this.logData.filter(e => {
                    const type = this.getEntryType(e);
                    return type === 'tool' || type === 'failed-tool';
                }).length;
                // Count failed tools separately for the badge
                this.stats.failedTool = this.logData.filter(e => this.getEntryType(e) === 'failed-tool').length;
                this.stats.user = this.logData.filter(e => this.getEntryType(e) === 'user').length;

                document.getElementById('totalEntries').textContent = this.stats.total;
                document.getElementById('assistantMessages').textContent = this.stats.assistant;
                document.getElementById('toolCalls').textContent = this.stats.tool;
                document.getElementById('systemMessages').textContent = this.stats.system;
                
                // Update failed tool badge
                this.updateFailedToolBadge();
                
                // Update session summary
                this.updateSessionSummary();
            }

            updateSessionSummary() {
                const summaryContainer = document.getElementById('sessionSummary');
                
                // Find session summary from result entries (not system entries)
                const sessionEntry = this.logData.find(entry => 
                    entry.type === 'result' && 
                    (entry.subtype === 'success' || entry.subtype === 'error_during_execution') &&
                    (entry.duration_ms !== undefined || entry.total_cost_usd !== undefined || entry.cost_usd !== undefined)
                );

                if (sessionEntry) {
                    const duration = sessionEntry.duration_ms ? `${(sessionEntry.duration_ms / 1000).toFixed(1)}s` : null;
                    const cost = sessionEntry.total_cost_usd || sessionEntry.cost_usd ? 
                        `$${(sessionEntry.total_cost_usd || sessionEntry.cost_usd).toFixed(4)}` : null;
                    const turns = sessionEntry.num_turns ? `${sessionEntry.num_turns} turns` : null;
                    const inputTokens = sessionEntry.usage?.input_tokens ? 
                        `${sessionEntry.usage.input_tokens.toLocaleString()} in` : null;
                    const outputTokens = sessionEntry.usage?.output_tokens ? 
                        `${sessionEntry.usage.output_tokens.toLocaleString()} out` : null;

                    let summaryParts = [];
                    if (duration) summaryParts.push(duration);
                    if (turns) summaryParts.push(turns);
                    if (cost) summaryParts.push(cost);
                    if (inputTokens) summaryParts.push(inputTokens);
                    if (outputTokens) summaryParts.push(outputTokens);

                    if (summaryParts.length > 0) {
                        summaryContainer.innerHTML = summaryParts.map(part => 
                            `<span class="session-stat">${part}</span>`
                        ).join('');
                        summaryContainer.style.display = 'flex';
                    } else {
                        summaryContainer.style.display = 'none';
                    }
                } else {
                    summaryContainer.style.display = 'none';
                }
            }

            updateFailedToolBadge() {
                const badge = document.getElementById('failedToolBadge');
                if (badge) {
                    badge.textContent = this.stats.failedTool;
                    if (this.stats.failedTool > 0) {
                        badge.classList.add('show');
                    } else {
                        badge.classList.remove('show');
                    }
                }
            }

            renderEntries() {
                const container = document.getElementById('logEntries');
                
                if (this.filteredData.length === 0) {
                    container.innerHTML = `
                        <div class="no-results">
                            <div class="no-results-icon">üîç</div>
                            <div>No entries found</div>
                            <div style="font-size: 11px; margin-top: 4px; color: #666666;">Try adjusting your search or filter criteria</div>
                        </div>
                    `;
                    return;
                }

                const entriesHtml = this.filteredData.map((entry, index) => 
                    this.renderEntry(entry, index)
                ).join('');

                container.innerHTML = entriesHtml;

                // Bind click events for expanding entries
                container.querySelectorAll('.log-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const entry = header.parentElement;
                        entry.classList.toggle('expanded');
                    });
                });

                // Bind click events for expanding tool results
                container.querySelectorAll('.tool-expand').forEach(expandBtn => {
                    expandBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const targetId = expandBtn.dataset.target;
                        const moreLines = expandBtn.dataset.moreLines;
                        const preview = expandBtn.parentElement.querySelector('.tool-preview');
                        const full = document.getElementById(targetId);
                        const btn = expandBtn.querySelector('.expand-btn');
                        
                        if (full.classList.contains('hidden')) {
                            preview.classList.add('hidden');
                            full.classList.remove('hidden');
                            btn.textContent = '‚ñ≤ collapse';
                        } else {
                            preview.classList.remove('hidden');
                            full.classList.add('hidden');
                            btn.textContent = `‚ñº ${moreLines} more lines`;
                        }
                    });
                });
            }

            renderEntry(entry, index) {
                const type = this.getEntryType(entry);
                const meta = this.getEntryMeta(entry);
                const content = this.getEntryContent(entry);
                
                return `
                    <div class="log-entry expanded" data-index="${index}">
                        <div class="log-header">
                            <div>
                                <span class="log-type ${type}">${type}</span>
                                <span class="log-meta">${meta}</span>
                            </div>
                            <span class="log-toggle">‚ñ≤</span>
                        </div>
                        <div class="log-content">
                            <div class="log-content-inner">
                                ${content}
                            </div>
                        </div>
                    </div>
                `;
            }

            getEntryMeta(entry) {
                const parts = [];
                const entryType = this.getEntryType(entry);
                
                // For assistant messages, look for tool calls
                if (entryType === 'assistant' && entry.message?.content) {
                    const toolCalls = entry.message.content.filter(item => item.type === 'tool_use');
                    if (toolCalls.length > 0) {
                        const toolNames = toolCalls.map(tool => tool.name);
                        parts.push(`‚Üí ${toolNames.join(', ')}`);
                    }
                }
                
                // For tool results, try to identify which tool
                if ((entryType === 'tool' || entryType === 'failed-tool') && entry.type === 'user' && entry.message?.content) {
                    const toolResult = entry.message.content.find(item => item.type === 'tool_result');
                    if (toolResult?.tool_use_id) {
                        parts.push(`‚Üê result`);
                    }
                }
                
                if (entry.tool_name) {
                    parts.push(`${entry.tool_name}`);
                }

                if (entry.message?.usage?.output_tokens) {
                    parts.push(`${entry.message.usage.output_tokens} tokens`);
                }

                return parts.join(' ‚Ä¢ ') || '';
            }

            getEntryContent(entry) {
                const entryType = this.getEntryType(entry);
                
                if (entryType === 'system') {
                    return this.renderSystemContent(entry);
                } else if (entryType === 'assistant') {
                    return this.renderAssistantContent(entry);
                } else if (entryType === 'tool' || entryType === 'failed-tool') {
                    return this.renderToolResultContent(entry);
                } else if (entry.type === 'user') {
                    return this.renderUserContent(entry);
                } else {
                    return this.renderJsonContent(entry);
                }
            }

            renderSystemContent(entry) {
                if (entry.subtype === 'init') {
                    const tools = entry.tools || [];
                    const mcpServers = entry.mcp_servers || [];
                    
                    return `
                        <div>
                            <div style="color: #86efac; font-weight: 600; margin-bottom: 8px;">System Initialization</div>
                            <div><span style="color: #888888;">Working Directory:</span> ${entry.cwd || 'N/A'}</div>
                            <div><span style="color: #888888;">Model:</span> ${entry.model || 'N/A'}</div>
                            <div><span style="color: #888888;">Permission Mode:</span> ${entry.permissionMode || 'N/A'}</div>
                            
                            ${tools.length > 0 ? `
                                <div style="margin-top: 12px;">
                                    <span style="color: #888888;">Available Tools (${tools.length}):</span>
                                    <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px;">
                                        ${tools.map(tool => `<span style="background: #1e3a8a; color: #93c5fd; padding: 2px 6px; border-radius: 3px; font-size: 10px;">${tool}</span>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${mcpServers.length > 0 ? `
                                <div style="margin-top: 12px;">
                                    <span style="color: #888888;">MCP Servers:</span>
                                    ${mcpServers.map(server => `
                                        <div style="margin-top: 4px;">
                                            <span style="font-weight: 500;">${server.name}</span>: 
                                            <span style="color: ${server.status === 'connected' ? '#86efac' : '#fca5a5'};">${server.status}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else if (entry.subtype === 'success' && 'result' in entry) {
                    // Format session result nicely
                    const duration = entry.duration_ms ? `${(entry.duration_ms / 1000).toFixed(1)}s` : 'N/A';
                    const cost = entry.total_cost_usd ? `$${entry.total_cost_usd.toFixed(4)}` : 'N/A';
                    const turns = entry.num_turns || 'N/A';
                    
                    return `
                        <div class="system-result">
                            <div class="result-header">‚úÖ Session Complete</div>
                            <div class="result-content">${entry.result ? this.formatText(entry.result) : '<em style="color: #888888;">No output message</em>'}</div>
                            <div class="result-metadata">
                                <div class="metadata-grid">
                                    <div class="metadata-item">
                                        <span class="metadata-label">Duration:</span>
                                        <span class="metadata-value">${duration}</span>
                                    </div>
                                    <div class="metadata-item">
                                        <span class="metadata-label">Turns:</span>
                                        <span class="metadata-value">${turns}</span>
                                    </div>
                                    <div class="metadata-item">
                                        <span class="metadata-label">Cost:</span>
                                        <span class="metadata-value">${cost}</span>
                                    </div>
                                    ${entry.usage?.input_tokens ? `
                                        <div class="metadata-item">
                                            <span class="metadata-label">Input Tokens:</span>
                                            <span class="metadata-value">${entry.usage.input_tokens.toLocaleString()}</span>
                                        </div>
                                    ` : ''}
                                    ${entry.usage?.output_tokens ? `
                                        <div class="metadata-item">
                                            <span class="metadata-label">Output Tokens:</span>
                                            <span class="metadata-value">${entry.usage.output_tokens.toLocaleString()}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                } else if (entry.subtype === 'error_during_execution') {
                    // Format session error nicely
                    const duration = entry.duration_ms ? `${(entry.duration_ms / 1000).toFixed(1)}s` : 'N/A';
                    const cost = entry.total_cost_usd || entry.cost_usd ? `$${(entry.total_cost_usd || entry.cost_usd).toFixed(4)}` : 'N/A';
                    const turns = entry.num_turns || 'N/A';
                    
                    return `
                        <div class="system-result error">
                            <div class="result-header">‚ùå Session Error</div>
                            <div class="result-content">
                                <em style="color: #fca5a5;">An error occurred during session execution</em>
                            </div>
                            <div class="result-metadata">
                                <div class="metadata-grid">
                                    <div class="metadata-item">
                                        <span class="metadata-label">Duration:</span>
                                        <span class="metadata-value">${duration}</span>
                                    </div>
                                    <div class="metadata-item">
                                        <span class="metadata-label">Turns:</span>
                                        <span class="metadata-value">${turns}</span>
                                    </div>
                                    <div class="metadata-item">
                                        <span class="metadata-label">Cost:</span>
                                        <span class="metadata-value">${cost}</span>
                                    </div>
                                    ${entry.usage?.input_tokens ? `
                                        <div class="metadata-item">
                                            <span class="metadata-label">Input Tokens:</span>
                                            <span class="metadata-value">${entry.usage.input_tokens.toLocaleString()}</span>
                                        </div>
                                    ` : ''}
                                    ${entry.usage?.output_tokens ? `
                                        <div class="metadata-item">
                                            <span class="metadata-label">Output Tokens:</span>
                                            <span class="metadata-value">${entry.usage.output_tokens.toLocaleString()}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }
                return this.renderJsonContent(entry);
            }

            renderAssistantContent(entry) {
                if (!entry.message?.content) {
                    return this.renderJsonContent(entry);
                }

                const content = entry.message.content;
                let html = '';

                content.forEach(item => {
                    if (item.type === 'text') {
                        html += `
                            <div class="terminal-text">
                                ${this.formatText(item.text)}
                            </div>
                        `;
                    } else if (item.type === 'tool_use') {
                        // Special handling for Bash commands
                        if (item.name === 'Bash' && item.input) {
                            const command = item.input.command;
                            const description = item.input.description;
                            
                            html += `
                                <div class="terminal-tool-call">
                                    <div class="tool-header"># ${item.name}</div>
                                    ${description ? `
                                        <div style="margin: 6px 0 8px 0; color: #cccccc; font-style: italic; font-size: 12px;">
                                            ${this.formatText(description)}
                                        </div>
                                    ` : ''}
                                    <pre class="tool-params">${command || JSON.stringify(item.input, null, 2)}</pre>
                                </div>
                            `;
                        } else if (item.name === 'mcp__github_file_ops__update_claude_comment' && item.input && item.input.body) {
                            // Special handling for GitHub comment updates - render as markdown
                            html += `
                                <div class="terminal-tool-call">
                                    <div class="tool-header"># ${item.name}</div>
                                    <div style="margin: 6px 0; padding: 8px; background: #1a1a1a; border: 1px solid #333333; border-radius: 3px; color: #ffffff; font-size: 11px; line-height: 1.4;">
                                        ${this.formatMarkdown(item.input.body)}
                                    </div>
                                </div>
                            `;
                        } else if (item.name === 'Glob' && item.input && item.input.pattern) {
                            // Special handling for Glob tool - show just the pattern
                            html += `
                                <div class="terminal-tool-call">
                                    <div class="tool-header"># ${item.name}</div>
                                    <pre class="tool-params">${item.input.pattern}</pre>
                                </div>
                            `;
                        } else if (item.name === 'LS' && item.input && item.input.path) {
                            // Special handling for LS tool - show just the path
                            html += `
                                <div class="terminal-tool-call">
                                    <div class="tool-header"># ${item.name}</div>
                                    <pre class="tool-params">${item.input.path}</pre>
                                </div>
                            `;
                        } else if (item.name === 'Read' && item.input && item.input.file_path) {
                            // Special handling for Read tool - show just the file path
                            html += `
                                <div class="terminal-tool-call">
                                    <div class="tool-header"># ${item.name}</div>
                                    <pre class="tool-params">${item.input.file_path}</pre>
                                </div>
                            `;
                        } else if (item.name === 'Edit' && item.input && item.input.file_path && item.input.old_string && item.input.new_string) {
                            // Special handling for Edit tool - show a nice diff view
                            html += `
                                <div class="terminal-tool-call">
                                    <div class="tool-header"># ${item.name}</div>
                                    <div class="edit-file-path">${item.input.file_path}</div>
                                    <div class="diff-container">
                                        ${this.renderDiff(item.input.old_string, item.input.new_string)}
                                    </div>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="terminal-tool-call">
                                    <div class="tool-header"># ${item.name}</div>
                                    <pre class="tool-params">${JSON.stringify(item.input, null, 2)}</pre>
                                </div>
                            `;
                        }
                    } else if (item.type === 'thinking') {
                        html += `
                            <div class="terminal-thinking">
                                <details open>
                                    <summary># thinking</summary>
                                    <div class="thinking-content">
                                        ${this.formatText(item.thinking)}
                                    </div>
                                </details>
                            </div>
                        `;
                    }
                });

                return html;
            }

            renderToolResultContent(entry) {
                // Handle tool results that come as user messages
                if (entry.type === 'user' && entry.message?.content) {
                    const toolResults = entry.message.content.filter(item => item.type === 'tool_result');
                    if (toolResults.length > 0) {
                        return toolResults.map((result, index) => {
                            const content = result.content;
                            let output = '';
                            
                            if (Array.isArray(content)) {
                                output = content.map(c => c.text || JSON.stringify(c)).join('\n');
                            } else if (typeof content === 'string') {
                                output = content;
                            } else {
                                output = JSON.stringify(content, null, 2);
                            }
                            
                            // More specific error detection
                            const isError = result.is_error === true || 
                                           (result.error !== undefined && result.error !== null) ||
                                           (typeof output === 'string' && output.toLowerCase().startsWith('error:'));
                            
                            const lines = output.split('\n');
                            const preview = lines.slice(0, 2).join('\n');
                            const hasMore = lines.length > 2;
                            const moreLineCount = Math.max(0, lines.length - 2);
                            
                            // Generate truly unique ID using entry index, result index, and random
                            const entryIndex = this.filteredData.indexOf(entry);
                            const uniqueId = `tool-result-${entryIndex}-${index}-${Math.random().toString(36).substr(2, 9)}`;
                            
                            // For failed tools, try to find and show the original tool call
                            let originalToolCallHtml = '';
                            if (isError && result.tool_use_id) {
                                const originalToolCall = this.findOriginalToolCall(result.tool_use_id);
                                if (originalToolCall) {
                                    originalToolCallHtml = `
                                        <div class="original-tool-call">
                                            <div class="original-tool-header"># Original Tool Call: ${originalToolCall.name}</div>
                                            <pre class="original-tool-params">${JSON.stringify(originalToolCall.input, null, 2)}</pre>
                                        </div>
                                    `;
                                }
                            }
                            
                            return `
                                <div class="terminal-tool-result">
                                    ${originalToolCallHtml}
                                    <div class="tool-output ${isError ? 'error' : 'success'}">
                                        <pre class="tool-preview">${preview}</pre>
                                        ${hasMore ? `
                                            <pre class="tool-full hidden" id="${uniqueId}">${output}</pre>
                                            <div class="tool-expand" data-target="${uniqueId}" data-more-lines="${moreLineCount}">
                                                <span class="expand-btn">‚ñº ${moreLineCount} more lines</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                }
                
                // Legacy tool content handling
                const result = entry.tool_result;
                const isError = result && (result.is_error || result.error);
                
                return `
                    <div class="terminal-tool-result">
                        ${result ? `
                            <div class="tool-output ${isError ? 'error' : 'success'}">
                                ${isError ? 
                                    `Error: ${result.error || result.content}` :
                                    `<pre>${typeof result.content === 'string' ? result.content : JSON.stringify(result, null, 2)}</pre>`
                                }
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            renderUserContent(entry) {
                if (entry.message?.content) {
                    const content = entry.message.content;
                    let html = '';
                    
                    content.forEach(item => {
                        if (item.type === 'text') {
                            html += `
                                <div class="terminal-text user-message">
                                    ${this.formatText(item.text)}
                                </div>
                            `;
                        }
                    });
                    
                    return html;
                }
                
                return this.renderJsonContent(entry);
            }

            renderJsonContent(entry) {
                return `
                    <div class="json-viewer">
                        ${this.syntaxHighlightJson(JSON.stringify(entry, null, 2))}
                    </div>
                `;
            }

            formatText(text) {
                if (!text) return '';
                
                // Convert newlines to <br> and preserve formatting
                return text
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/\n/g, '<br>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code style="background: #2a2a2a; padding: 2px 4px; border-radius: 3px; font-family: monospace;">$1</code>');
            }

            formatMarkdown(text) {
                if (!text) return '';
                
                // Escape HTML first
                let html = text
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');

                // Convert markdown elements
                html = html
                    // Headers - keep same font size but make them bold and add spacing
                    .replace(/^### (.*$)/gm, '<div style="color: #ffffff; font-weight: 600; margin: 12px 0 8px 0;">$1</div>')
                    .replace(/^## (.*$)/gm, '<div style="color: #ffffff; font-weight: 600; margin: 16px 0 10px 0;">$1</div>')
                    .replace(/^# (.*$)/gm, '<div style="color: #ffffff; font-weight: 600; margin: 20px 0 12px 0;">$1</div>')
                    
                    // Bold and italic
                    .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #ffffff;">$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em style="color: #cccccc;">$1</em>')
                    
                    // Inline code
                    .replace(/`(.*?)`/g, '<code style="background: #2a2a2a; color: #86efac; padding: 2px 4px; border-radius: 3px; font-family: monospace;">$1</code>')
                    
                    // Links
                    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" style="color: #667eea; text-decoration: underline;" target="_blank" rel="noopener noreferrer">$1</a>')
                    
                    // Checkboxes
                    .replace(/^- \[x\] (.*)$/gm, '<div style="margin: 4px 0; display: flex; align-items: center;"><input type="checkbox" checked disabled style="margin-right: 8px; accent-color: #667eea;"><span style="color: #86efac;">$1</span></div>')
                    .replace(/^- \[ \] (.*)$/gm, '<div style="margin: 4px 0; display: flex; align-items: center;"><input type="checkbox" disabled style="margin-right: 8px; accent-color: #667eea;"><span style="color: #ffffff;">$1</span></div>')
                    
                    // Regular list items
                    .replace(/^- (.*)$/gm, '<div style="margin: 4px 0; padding-left: 16px; position: relative;"><span style="position: absolute; left: 0; color: #888888;">‚Ä¢</span><span style="color: #ffffff;">$1</span></div>')
                    
                    // Horizontal rule
                    .replace(/^---$/gm, '<hr style="border: none; border-top: 1px solid #444444; margin: 16px 0;">')
                    
                    // Line breaks
                    .replace(/\n/g, '<br>');

                return html;
            }

            syntaxHighlightJson(json) {
                return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                    let cls = 'json-number';
                    if (/^"/.test(match)) {
                        if (/:$/.test(match)) {
                            cls = 'json-key';
                        } else {
                            cls = 'json-string';
                        }
                    } else if (/true|false/.test(match)) {
                        cls = 'json-boolean';
                    } else if (/null/.test(match)) {
                        cls = 'json-null';
                    }
                    return '<span class="' + cls + '">' + match + '</span>';
                });
            }

            loadDataFromInput() {
                const jsonInput = document.getElementById('jsonInput');
                const jsonText = jsonInput.value.trim();

                if (!jsonText) {
                    this.setLoadStatus('Please paste JSON data first', 'error');
                    return;
                }

                try {
                    this.setLoadStatus('Parsing JSON...', '');
                    const data = JSON.parse(jsonText);
                    
                    // Validate that it's an array
                    if (!Array.isArray(data)) {
                        throw new Error('JSON must be an array of log entries');
                    }

                    this.logData = data;
                    this.filteredData = [...this.logData];
                    this.updateStats();
                    this.renderEntries();
                    document.getElementById('dataInputOverlay').classList.add('hidden');
                    this.setLoadStatus(`Successfully loaded ${data.length} entries!`, 'success');
                    
                    // Clear the success message after 3 seconds
                    setTimeout(() => {
                        this.setLoadStatus('', '');
                    }, 3000);

                } catch (error) {
                    console.error('JSON Parse Error:', error);
                    this.setLoadStatus(`Invalid JSON: ${error.message}`, 'error');
                }
            }

            renderDiff(oldString, newString) {
                // Simple line-by-line diff implementation
                const oldLines = oldString.split('\n');
                const newLines = newString.split('\n');
                
                let html = '<div class="diff-header">Changes</div>';
                
                // Find common prefix and suffix to optimize display
                let commonStart = 0;
                let commonEnd = 0;
                
                // Find common lines at the start
                while (commonStart < oldLines.length && 
                       commonStart < newLines.length && 
                       oldLines[commonStart] === newLines[commonStart]) {
                    commonStart++;
                }
                
                // Find common lines at the end
                while (commonEnd < (oldLines.length - commonStart) && 
                       commonEnd < (newLines.length - commonStart) && 
                       oldLines[oldLines.length - 1 - commonEnd] === newLines[newLines.length - 1 - commonEnd]) {
                    commonEnd++;
                }
                
                let lineNumber = 1;
                
                // Show context before changes (limited)
                const contextStart = Math.max(0, commonStart - 2);
                for (let i = contextStart; i < commonStart; i++) {
                    html += `
                        <div class="diff-line context">
                            <div class="diff-line-number">${lineNumber}</div>
                            <div class="diff-line-content">${this.escapeHtml(oldLines[i])}</div>
                        </div>
                    `;
                    lineNumber++;
                }
                
                // Show removed lines
                const removedLines = oldLines.slice(commonStart, oldLines.length - commonEnd);
                for (let i = 0; i < removedLines.length; i++) {
                    html += `
                        <div class="diff-line removed">
                            <div class="diff-line-number">-</div>
                            <div class="diff-line-content">${this.escapeHtml(removedLines[i])}</div>
                        </div>
                    `;
                }
                
                // Show added lines
                const addedLines = newLines.slice(commonStart, newLines.length - commonEnd);
                for (let i = 0; i < addedLines.length; i++) {
                    html += `
                        <div class="diff-line added">
                            <div class="diff-line-number">+</div>
                            <div class="diff-line-content">${this.escapeHtml(addedLines[i])}</div>
                        </div>
                    `;
                }
                
                // Show context after changes (limited)
                const contextEnd = Math.min(oldLines.length, oldLines.length - commonEnd + 2);
                for (let i = oldLines.length - commonEnd; i < contextEnd; i++) {
                    if (i < oldLines.length) {
                        html += `
                            <div class="diff-line context">
                                <div class="diff-line-number">${lineNumber}</div>
                                <div class="diff-line-content">${this.escapeHtml(oldLines[i])}</div>
                            </div>
                        `;
                        lineNumber++;
                    }
                }
                
                return html;
            }

            escapeHtml(text) {
                if (!text) return '';
                return text
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;');
            }

            setLoadStatus(message, type = '') {
                const statusEl = document.getElementById('loadStatus');
                statusEl.textContent = message;
                statusEl.className = `load-status ${type}`;
            }
        }

        // Initialize the viewer when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ClaudeTerminalLogViewer();
        });
    </script>
</body>
</html>
